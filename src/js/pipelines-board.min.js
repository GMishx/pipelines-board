!function(){function t(t){return"left"===t?0:"right"===t?100:"top"===t?0:"bottom"===t?100:"middle"===t?50:parseFloat(t)}var e=function(t,e){var r=(e=e||{}).markersFillColor||"#000";if(this.elements=e.data,this.arrowLineOptions=e.arrowLineOptions,this.parentEl=document.getElementById(t),!this.parentEl)throw Error("Please specify existing parent element in new PipelinesBoard(...)");this.parentEl.classList.add("pipelines-board"),this.svgEl=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgEl.setAttribute("class","pipelines-board__svg-overlay"),this.svgEl.setAttribute("width","100%"),this.svgEl.setAttribute("height","100%"),this.svgEl.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");var n=document.createElementNS("http://www.w3.org/2000/svg","defs"),i=document.createElementNS("http://www.w3.org/2000/svg","marker");i.setAttribute("id","arrowRight"),i.setAttribute("markerWidth","10"),i.setAttribute("markerHeight","10"),i.setAttribute("refX","0"),i.setAttribute("refY","3"),i.setAttribute("orient","auto"),i.setAttribute("markerUnits","strokeWidth"),i.innerHTML='<path d="M0,0 L0,6 L10,3 z" fill="'+r+'" />',n.append(i);var o=document.createElementNS("http://www.w3.org/2000/svg","marker");o.setAttribute("id","arrowLeft"),o.setAttribute("markerWidth","10"),o.setAttribute("markerHeight","10"),o.setAttribute("refX","10"),o.setAttribute("refY","3"),o.setAttribute("orient","auto"),o.setAttribute("markerUnits","strokeWidth"),o.innerHTML='<path d="M9,0 L9,6 L0,3 z" fill="'+r+'" />',n.append(o);var s=document.createElementNS("http://www.w3.org/2000/svg","marker");s.setAttribute("id","circle"),s.setAttribute("markerWidth","6"),s.setAttribute("markerHeight","6"),s.setAttribute("refX","3"),s.setAttribute("refY","3"),s.setAttribute("orient","auto"),s.setAttribute("markerUnits","strokeWidth"),s.innerHTML='<circle cx="3" cy="3" r="3" fill="'+r+'" />',n.append(s),this.svgEl.append(n),this.parentEl.append(this.svgEl),this.drawNodes(),this.drawLinks();var a=this;window.onresize=function(t){a.drawLinks()}};e.prototype.reDraw=function(){this.drawLinks()},e.prototype.clean=function(){for(var t=Array.from(this.svgEl.children),e=0,r=t.length;e<r;e++){var n=t[e];"defs"!==n.tagName&&n.remove()}},e.prototype.drawNodes=function(){$.circleProgress.defaults.size=19;for(var t=0,e=this.elements.length;t<e;t++){var r=this.elements[t],n=this.addNewPhase(r.phase);this.addNewNode(n,r)}},e.prototype.addNewPhase=function(t){var e,r=this.parentEl;return(e=document.getElementById(t))||((e=document.createElement("div")).setAttribute("id",t),e.classList.add("pipelines-board__phase"),r.appendChild(e)),e},e.prototype.addNewNode=function(t){this.elements.push(t);var e=this.addNewPhase(t.phase);this.addNewNode(e,t)},e.prototype.addNewNode=function(t,e){var r;r=typeof t==typeof{}?t:document.getElementById(t);var n=e.id,i=document.createElement("div");i.setAttribute("id",n),i.classList.add("pipelines-board__phase__job");var o=document.createElement("table");o.insertRow(0);i.appendChild(o),void 0!==e.progress&&this.updateNodeProgressbar(n,e.progress,i),this.updateNodeTitle(n,e.title,i),void 0!=e.action&&this.updateNodeAction(n,e.action,i),void 0!=e.link?(""===e.link&&(e.link="#"),r.appendChild(this.updateNodeLink(n,e.link,i))):r.appendChild(i)},e.prototype.updateNodeProgressbar=function(t,e,r){var n,i,o,s,a=this.getNodeIndexById(t);a.progress.min=e.min||a.progress.min,a.progress.max=e.max||a.progress.max,a.progress.current=e.current||a.progress.current,a.progress.color=e.color||a.progress.color,n=a.progress.min||0,i=a.progress.max||100,o=a.progress.current||0,s=e.color||"#080",o=(o-n)/(i-n);var d,l=document.createElement("span");l.setAttribute("id",t+"_prog"),l.classList.add("pipelines-board__phase__job__progress"),$(l).circleProgress({value:o,startAngle:4.712389,thickness:5,fill:s}),(d=document.getElementById(t+"_prog"))?d.parentNode.replaceChild(l,d):void 0!==r?$(r).find("tr")[0].insertCell(0).appendChild(l):$("#"+parentNode).find("tr")[0].insertCell(0).appendChild(l)},e.prototype.updateNodeTitle=function(t,e,r){this.getNodeIndexById(t).title=e;var n,i=document.createElement("span");i.setAttribute("id",t+"_title"),i.classList.add("pipelines-board__phase__job__title"),i.classList.add("wrapword"),i.innerHTML=e,(n=document.getElementById(t+"_title"))?n.parentNode.replaceChild(i,n):void 0!==r?document.getElementById(t+"_prog")?$(r).find("tr")[0].insertCell(1).appendChild(i):$(r).find("tr")[0].insertCell(-1).appendChild(i):document.getElementById(t+"_prog")?$("#"+parentNode).find("tr")[0].insertCell(1).appendChild(i):$("#"+parentNode).find("tr")[0].insertCell(-1).appendChild(i)},e.prototype.updateNodeAction=function(t,e,r){this.getNodeIndexById(t).action=e;var n,i=document.createElement("span");i.setAttribute("id",t+"_action"),i.classList.add("pipelines-board__phase__job__action");for(var o=0,s=e.length;o<s;o++){var a=e[o].text||"",d=e[o].callback,l=document.createElement("button");l.classList.add("pipelines-board__phase__job__action__button"),l.innerHTML=a,l.setAttribute("node-id",t),l.setAttribute("action-text",a),l.onclick=function(){d(this)},i.appendChild(l)}(n=document.getElementById(t+"_action"))?n.parentNode.replaceChild(i,n):void 0!==r?document.getElementById(t+"_prog")?$(r).find("tr")[0].insertCell(2).appendChild(i):$(r).find("tr")[0].insertCell(-1).appendChild(i):document.getElementById(t+"_prog")?$("#"+parentNode).find("tr")[0].insertCell(2).appendChild(i):$("#"+parentNode).find("tr")[0].insertCell(-1).appendChild(i)},e.prototype.updateNodeLink=function(t,e,r){this.getNodeIndexById(t).link=e;var n=document.createElement("a");if(n.setAttribute("id",t+"_link"),n.setAttribute("href",e),void 0!==r)return n.appendChild(r),n;var i=document.getElementById(t);if(n.appendChild(i),"A"!==i.parentNode.tagName)i.parentNode.replaceChild(n,i);else{var o=i.parentNode;o.parentNode.replaceChild(n,o)}return null},e.prototype.updateNodeNext=function(t,e){var r=this.getNodeIndexById(t);void 0===r.next?r.next=[e]:r.next.push(e),this.drawLinks()},e.prototype.setNodeProgress=function(t,e){this.getNodeIndexById(t).progress.current=e,this.reDrawProgressbar(t)},e.prototype.reDrawProgressbar=function(t){var e=this.getNodeIndexById(t),r=e.progress.min||0,n=e.progress.max||100,i=e.progress.current||0,o=e.progress.color||"#080";i=(i-r)/(n-r);var s=document.getElementById(t+"_prog");if(s)$(s).circleProgress("value",i);else{var a={progress:{min:r,max:n,current:e.progress.current||0,color:o}};updateNodeProgressbar(t,a)}},e.prototype.drawLinks=function(){this.clean();for(var t=0,e=this.elements.length;t<e;t++){var r=this.elements[t];if(void 0!==r.next)for(var n=0,i=r.next.length;n<i;n++)this.arrowLine(this.arrowLineOptions).from(r.id).to(r.next[n])}},e.prototype.getNodeIndexById=function(t){for(var e=0,r=this.elements.length;e<r;e++){var n=this.elements[e];if(n.id==t)return n}throw"Node id "+t+" not found!"},e.prototype.arrowLine=function(t){return new r(this.svgEl,t)};var r=function(e,r){this.svgCanvas=e;var n=new s(this.svgCanvas);this.canvasTopLeftCorner=new o(n.getX(),n.getY()),this.options=Object.assign({},{startOn:"right middle",endOn:"left middle",lineColor:"black",lineTension:1,markerStartColor:"black",markerEndColor:"black",markerStart:null,markerEnd:null},r);var i=this.options.startOn.split(" ");if(2!==i.length)throw Error("please specify startOn option for new ArrowLine as in: 'right middle'");this.lineStartPoint=new a(t(i[0]),t(i[1]));var d=this.options.endOn.split(" ");if(2!==d.length)throw Error("please specify endOn option for new ArrowLine as in: 'right middle'");this.lineEndPoint=new a(t(d[0]),t(d[1]))};r.prototype.from=function(t){var e=document.getElementById(t);if(!e)throw Error("Please specify an existing element's id in arrow.from(...)");return this.fromRectangle=new s(e),this},r.prototype.to=function(t){var e=document.getElementById(t);if(!e)throw Error("Please specify an existing element's id in arrow.to(...)");return this.toRectangle=new s(e),this.fromPoint=this.lineStartPoint.abs(this.fromRectangle).minus(this.canvasTopLeftCorner),this.toPoint=this.lineEndPoint.abs(this.toRectangle).minus(this.canvasTopLeftCorner),this.line=new n(this.fromPoint,this.toPoint,{color:this.options.lineColor,tension:this.options.lineTension,markerStart:this.options.markerStart,markerEnd:this.options.markerEnd}),this.line.draw().append(this.svgCanvas),this};var n=function(t,e,r){r=r||{},this.fromPoint=t,this.toPoint=e,this.color=r.color||"black",this.tension=r.tension||1,this.markerStart=r.markerStart,this.markerEnd=r.markerEnd,"arrowLeft"===this.markerStart&&(this.fromPoint.x+=10),"arrowRight"===this.markerEnd&&(this.toPoint.x-=10)};n.prototype.draw=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","path"),e=(this.toPoint.x-this.fromPoint.x)*this.tension,r=this.fromPoint.x+e,n=this.fromPoint.y,o=this.toPoint.x-e,s=this.toPoint.y,a="M "+this.fromPoint.x+" "+this.fromPoint.y+" C "+r+" "+n+" "+o+" "+s+" "+this.toPoint.x+" "+this.toPoint.y;return t.setAttributeNS(null,"d",a),t.setAttributeNS(null,"fill","none"),t.setAttributeNS(null,"stroke",this.color),this.markerStart&&t.setAttributeNS(null,"marker-start","url(#"+this.markerStart+")"),this.markerEnd&&t.setAttributeNS(null,"marker-end","url(#"+this.markerEnd+")"),new i(t)};var i=function(t){this.svgEl=t};i.prototype.append=function(t){t.appendChild(this.svgEl)};var o=function(t,e){this.x=t,this.y=e};o.prototype.minus=function(t){return new o(this.x-t.x,this.y-t.y)};var s=function(t){this.boundingRectangle=t.getBoundingClientRect()};s.prototype.getX=function(){return this.boundingRectangle.left},s.prototype.getWidth=function(){return this.boundingRectangle.width},s.prototype.getY=function(){return this.boundingRectangle.top},s.prototype.getHeight=function(){return this.boundingRectangle.height};var a=function(t,e){if("number"!=typeof t)throw Error("RelativePointPercentage.percentageLeft must be a number");if("number"!=typeof e)throw Error("RelativePointPercentage.percentageTop must be a number");this.percentageLeft=t,this.percentageTop=e};a.prototype.abs=function(t){return new o(t.getX()+t.getWidth()*this.percentageLeft*.01,t.getY()+t.getHeight()*this.percentageTop*.01)},window.PipelinesBoard=e}();